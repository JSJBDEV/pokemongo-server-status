<!DOCTYPE html>
<!--
Created by Poke Tips Admin
http://poke.tips
-->
<html>
<head>
  <title>Pokemon Go Server Status</title>
  <style>
   .up{
     color: green;
   }
   .slow{
     color:orange;
   }
   .down{
     color:red;
   }
   .load{
     font-style: italic;
     color: grey;
   }
   button{
     background-color: #27a632;
   }
   button:hover{
     background-color: black;
   }
  </style>

</head>

<body>
  <h1>Pokemon Go servers are: <span id="server" class="load"></span></h1>
  <p id="up" class="serverpara">Pokemon Go servers seem to be up. If you can't access Pokemon Go, then try restarting the app. <br><button class="refresh">Refresh Status</button></p>
  <p id="slow" class="serverpara">Pokemon Go servers seem to be up, but can be very slow. However, it also means that servers will be down temporarily.<br><button class="refresh">Refresh Status</button></p>
  <p id="down" class="serverpara">Pokemon Go servers seem to be down. We'll have to wait until Niantic fixes their servers.<br><button class="refresh">Refresh Status</button></p>

  <script src="https://code.jquery.com/jquery-1.12.4.min.js"
  			  integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ="
  			  crossorigin="anonymous"></script>

  <script src="ping.js"></script>

  <script>
   jQuery(".serverpara").hide(); //Hide the paragraphs
    var avgTime = []; //We're going to push the server response time in ms here.
    var i = 0;
    function add(a,b){ //We'll need this to add all the items from the avgTime array
      return a+b;
    }
    function serverStatus(){
      jQuery('#server').text("Loading " + Math.round((i/10)*100) + "%").removeClass().addClass('load'); //Loading Text. Basically shows percentages when i++
      if(i < 10){
        ping('https://pgorelease.nianticlabs.com/plfe/').then(function(delta){ //This is the url that reddit found
          avgTime.push(delta); //Pushes server response time in ms to array
          i++;
          serverStatus(); //recur
        }).catch(function(err){ //This means server is down or something
          i++;
          serverStatus(); //recur
        });
      }
      if(i == 10){ //When we reach 10 iterations,
        var pinged = avgTime.reduce(add,0) / avgTime.length; //the average of all the response times
        if(pinged < 800){ //800 ms should state up
          jQuery('#server').text("Up");
          jQuery('#server').removeClass().addClass('up');
          jQuery('#up').show();
        }
        else if(pinged > 800 && pinged < 3000){ //Server is slow
          jQuery('#server').text("Slow");
          jQuery('#server').removeClass().addClass('slow');
          jQuery('#slow').show();
        }
        else if(pinged > 3000){ //Server is prob down
          jQuery('#server').text("Down");
          jQuery('#server').removeClass().addClass('down');
          jQuery('#down').show();
        }
        else{
          jQuery('#server').text("Unreachable");
          jQuery('#server').removeClass().addClass('down');
          jQuery('#down').show();
        }
      }
    }
    serverStatus();
    jQuery('.refresh').bind('click',function(){ //Refresh button
      jQuery(".serverpara").hide();
      i = 0;
      serverStatus();
    });
  </script>
</body>

</html>
